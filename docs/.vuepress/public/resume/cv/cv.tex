\preloadtypescripts
% \showframe
% % \showframe[edge]
% % \setupbackgrounds[page][frame=on]
% \showlayout

% Enable hyperlinks
\setupinteraction
  [state=start,
  title={Mohamed Bana --- Full Stack Senior Software Engineer --- CV},
  style=,
  color=red,
  contrastcolor=blue]

% make chapter, section bookmarks visible when opening document
\placebookmarks[chapter, section, subsection, subsubsection, subsubsubsection, subsubsubsubsection][chapter, section]
\setupinteractionscreen[option=bookmark]
\setuptagging[state=start]

% % use microtypography
% \definefontfeature[default][default][script=latn, protrusion=quality, expansion=quality, itlc=yes, textitalics=yes, onum=yes, pnum=yes]
% \definefontfeature[smallcaps][script=latn, protrusion=quality, expansion=quality, smcp=yes, onum=yes, pnum=yes]
% % \setupalign[hz,hanging]
% \setuptolerance[horizontal, tolerant, stretch]
% \setupitaliccorrection[global, always]

% \setupindenting[1em]
% \indenting[yes,next]

\enableregime[utf]
\setuppapersize[A4][A4]

\usetypescriptfile[type-alegreya]
\usetypescript[alegreya]
\setupbodyfont[alegreya]
\setupbodyfont[8pt]

% \setupwhitespace[big]
% \setupindenting[big]
\setupwhitespace[flexible]
% \setupindenting[small]
% \indenting[yes,next]

% \setupindenting[yes,big]
% \setupblank[big]

\setupheader[style=\smallcaps]
\setupfooter[style=\smallcaps]

\setuppagenumbering[location={}]
\setuplayout[
  marking=on,
  height=fit,
  width=fit,
  % leftmargin=2mm,
  rightmargin=0mm,
  left=2mm,
  right=2mm,
  rightedge=2mm,
  rightedgedistance=0mm,
  top=2mm,
  topspace=2mm,
  topdistance=2mm,
  bottom=2mm,
  bottomdistance=0mm,
  % headerdistance=0mm,
  % footerdistance=0mm,
  % topspace=8mm,
  header=32pt,
  footer=8pt,
  % backspace=0mm
  backspace=8pt,
  ]

% \definemixedcolumns
%   [sectioncolumns]
%   [
%     n=2,
%     separator=rule,
%     rulecolor=black,
%     rulethickness=1pt,
%     % balance=yes,
%   ]

% \setupalign[verytolerant]

% % Horizontal line below the section header.
% \defineframed[sectionframed]
%   [
%      frame=on,
%     %  bottomframe=on,
%      framecolor=black,
%      rulethickness=1pt,
%     frame=off,
%     bottomframe=on,
%     width=local,
%     align={normal,verytolerant,stretch}, % to get a vbox
%   ]

% \define[2]\StyleSection{\sectionframed{#2}}

\setuphead
    [section]
    [
      page=no,
      % continue=yes,
      numberstyle=smallcaps,style=bold,textstyle=smallcaps,
      % command=\StyleSection,
      tolerance=tolerant,
      % after={\startsectioncolumns},
      % aftersection={\stopsectioncolumns},
      before={\blank[none]},
      % before={\nowhitespace},
      after={\blank[none]\nowhitespace\hairline\blank[none]},
      beforesection={\blank[none]},
      aftersection={\blank[none]},
      % header=empty,
      % align=middle,
    ]

\setuphead
    [subsection]
    [
      page=no,
      % continue=yes,
      numberstyle=smallcaps,style=bold,textstyle=smallcaps,
      % command=\StyleSection,
      tolerance=tolerant,
      % after={\startsectioncolumns},
      % aftersection={\stopsectioncolumns},
      before={\blank[none]},
      % before={\nowhitespace},
      after={\blank[none]\nowhitespace\hairline\blank[none]},
      % aftersubsection={}
      beforesubsection={\blank[none]},
      aftersubsection={\blank[none]},
      % header=empty,
      % align=middle,
      align={middle, hyphenated, verytolerant},
      % align={flushleft, nothyphenated, verytolerant},
    ]
\setuphead
    [subsubsection]
    [
      page=no,
      % continue=yes,
      numberstyle=smallcaps,style=bold,textstyle=smallcaps,
      % command=\StyleSection,
      tolerance=tolerant,
      % after={\startsectioncolumns},
      % aftersection={\stopsectioncolumns},
      before={\blank[none]},
      % before={\nowhitespace},
      after={\blank[none]},
      beforesubsubsection={\blank[none]},
      aftersubsubsection={\blank[none]},
      % header=empty,
      % align=right,
      align={flushleft, hyphenated, verytolerant},
    ]

% \setuphead[subsection][command={\StyleSection},page=no,continue=yes,numberstyle=smallcaps,style=bold,textstyle=smallcaps,before={},after={\startcolumnset[StyleColumns]},aftersubsection={\stopcolumnset}]
% \setuphead[subsubsection][command={\StyleSection},page=no,continue=yes,numberstyle=smallcaps,style=bold,textstyle=smallcaps]

\setupheadertexts
  [\tfd{\smallcaps{\bf{Mohamed Bana — Full Stack Senior Software Engineer — CV}}}]

% \setupfootertexts
%   [\smallcaps{\bf{Last Updated: }}\smallcaps{\currentdate[weekday,month,day,{, },year]}]
\setupfootertexts
  [{\bf{Last Updated: }}{\currentdate[weekday,month,day,{, },year]}]

% \setupitemize[autointro]    % prevent orphan list intro
% \setupitemize[indentnext=no]

% \setupfloat[figure][default={here,nonumber}]
% \setupfloat[table][default={here,nonumber}]

% \setupthinrules[width=15em] % width of horizontal rules

% \setupxtable[frame=off]
% \setupxtable[head][topframe=on,bottomframe=on]
% \setupxtable[body][]
% \setupxtable[foot][bottomframe=on]

\usemodule[filter]
\traceexternalfilters

\defineexternalfilter
  [markdown]
  [filter={pandoc -f markdown-escaped_line_breaks --fail-if-warnings --pdf-engine=context -w context+ntb -o \externalfilteroutputfile }]

\starttext
\startcolumns[n=2, distance=5mm, rule=on, balance=yes,align=flushleft]
\processmarkdownfile{../cv.md}
\stopcolumns
\stoptext
